{"version":3,"file":"index.cjs","sources":["../../src/vite/helpers.ts","../../src/vite/git.ts","../../src/vite/markdownSection.ts"],"sourcesContent":["import type { Commit, CommitAuthor, Contributor, MergedRawCommit, RawCommit } from '../types'\n\nimport { basename, dirname, extname, posix, relative, sep, win32 } from 'node:path'\n\nimport { omit } from 'es-toolkit'\nimport { execa } from 'execa'\nimport { subtle } from 'uncrypto'\nimport { normalizePath } from 'vite'\n\nexport interface Helpers {\n  /**\n   * A helper function to help to determine whether the passed string parameter equals the\n   * current transforming module ID with normalization of paths capabilities and\n   * cross platform / OS compatibilities.\n   *\n   * @param equalsWith - String to equal with\n   * @returns boolean\n   */\n  idEquals: (equalsWith: string) => boolean\n  /**\n   * A helper function to help to determine whether the passed string parameter startsWith the\n   * current transforming module ID with normalization of paths capabilities and\n   * cross platform / OS compatibilities.\n   *\n   * @param startsWith - String to start with\n   * @returns boolean\n   */\n  idStartsWith: (startsWith: string) => boolean\n  /**\n   * A helper function to help to determine whether the passed string parameter endsWith the\n   * current transforming module ID with normalization of paths capabilities and\n   * cross platform / OS compatibilities.\n   *\n   * @param endsWith - String to end with\n   * @returns boolean\n   */\n  idEndsWith: (endsWith: string) => boolean\n  /**\n   * A helper function to help to determine whether the passed first path parameter\n   * equals the second passed string with normalization of paths capabilities and\n   * cross platform / OS compatibilities.\n   *\n   * @param path - Path to be compared with\n   * @param equalsWith - String to equal with\n   * @returns boolean\n   */\n  pathEquals: (path: string, equalsWith: string) => boolean\n  /**\n   * A helper function to help to determine whether the passed first path parameter\n   * startsWith the second passed string with normalization of paths capabilities and\n   * cross platform / OS compatibilities.\n   *\n   * @param path - Path to be compared with\n   * @param startsWith - String to start with\n   * @returns boolean\n   */\n  pathStartsWith: (path: string, startsWith: string) => boolean\n  /**\n   * A helper function to help to determine whether the passed first path parameter\n   * endsWith the second passed string with normalization of paths capabilities and\n   * cross platform / OS compatibilities.\n   *\n   * @param path - Path to be compared with\n   * @param endsWith - String to end with\n   * @returns boolean\n   */\n  pathEndsWith: (path: string, endsWith: string) => boolean\n}\n\nexport function pathEquals(path: string, equals: string): boolean {\n  return normalizePath(path) === (normalizePath(equals))\n}\n\nexport function pathStartsWith(path: string, startsWith: string): boolean {\n  return normalizePath(path).startsWith(normalizePath(startsWith))\n}\n\nexport function pathEndsWith(path: string, startsWith: string): boolean {\n  return normalizePath(path).endsWith(normalizePath(startsWith))\n}\n\nexport function createHelpers(root: string, id: string): Helpers {\n  const relativeId = relative(root, id)\n\n  return {\n    pathStartsWith,\n    pathEquals,\n    pathEndsWith,\n    idEndsWith(endsWith: string) {\n      return pathEndsWith(relativeId, endsWith)\n    },\n    idEquals(equals: string) {\n      return pathEquals(relativeId, equals)\n    },\n    idStartsWith(startsWith: string) {\n      return pathStartsWith(relativeId, startsWith)\n    },\n  }\n}\n\n/**\n * Hashes a string using SHA-256\n *\n * Official example by MDN: https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest\n * @param {string} message - The message to be hashed\n * @returns {Promise<string>} - The SHA-256 hash of the message\n */\nexport async function digestStringAsSHA256(message: string) {\n  const msgUint8 = new TextEncoder().encode(message) // encode as (utf-8) Uint8Array\n  const hashBuffer = await subtle.digest('SHA-256', msgUint8) // hash the message\n  const hashArray = Array.from(new Uint8Array(hashBuffer)) // convert buffer to byte array\n  const hashHex = hashArray\n    .map(b => b.toString(16).padStart(2, '0'))\n    .join('') // convert bytes to hex string\n  return hashHex\n}\n\nexport function normalizeGitLogPath(path: string[][]) {\n  // normalize paths\n  for (const [index, files] of path.entries()) {\n    if (files[1])\n      path[index][1] = normalizePath(files[1])\n\n    if (files[2])\n      path[index][2] = normalizePath(files[2])\n  }\n\n  return path\n}\n\nexport type CommitToStringHandler = (commit: Commit) => string | Promise<string> | null | undefined\nexport type CommitToStringsHandler = (commit: Commit) => string[] | Promise<string[]> | null | undefined\nexport type CommitAndPathToStringHandler = (commit: Commit, path: string) => string | Promise<string> | null | undefined\nexport interface RewritePathsBy { handler?: CommitAndPathToStringHandler }\n\nexport const defaultCommitURLHandler = (commit: Commit) => `${commit.repo_url}/commit/${commit.hash}`\nexport const defaultReleaseTagURLHandler = (commit: Commit) => `${commit.repo_url}/releases/tag/${commit.tag}`\nexport const defaultReleaseTagsURLHandler = (commit: Commit) => commit.tags?.map(tag => `${commit.repo_url}/releases/tag/${tag}`)\n\nexport async function returnOrResolvePromise<T>(val: T | Promise<T>) {\n  if (!(val instanceof Promise))\n    return val\n\n  return await val\n}\n\nexport function rewritePaths(path: string, rewritePaths: Record<string, string>) {\n  // rewrite paths\n  for (const [key, value] of Object.entries(rewritePaths))\n    path = path.replace(key, value)\n\n  return path\n}\n\nexport async function rewritePathsByPatterns(commit: Commit, path: string, patterns?: RewritePathsBy): Promise<string> {\n  if (typeof patterns === 'undefined' || patterns === null)\n    return path\n\n  if ('handler' in patterns && typeof patterns.handler === 'function') {\n    const resolvedPath = await returnOrResolvePromise(patterns.handler(commit, path))\n    if (!resolvedPath)\n      return path\n\n    return resolvedPath\n  }\n\n  return path\n}\n\n/**\n * A rewritePathsBy.handler handler that rewrites paths by rewriting the extension.\n *\n * @example\n *\n * ```typescript\n * import { GitChangelog, rewritePathsByRewritingExtension } from '@nolebase/vitepress-plugin-git-changelog/vite'\n *\n * GitChangelog({\n *   rewritePathsBy: {\n *     // to rewrite `example.md` to `example.html`\n *     handler: rewritePathsByRewritingExtension('.md', '.html')\n *   }\n * })\n * ```\n *\n * @param from - The extension to rewrite from.\n * @param to - The extension to rewrite to.\n * @returns A handler that rewrites paths by rewriting the extension.\n */\nexport function rewritePathsByRewritingExtension(from: string, to: string) {\n  return (_: Commit, path: string) => {\n    const ext = extname(path)\n    if (ext !== from)\n      return path\n\n    return path.replace(new RegExp(`${from}$`), to)\n  }\n}\n\nexport function parseGitLogRefsAsTags(refs?: string): string[] {\n  if (!refs)\n    return []\n\n  const refsArray = refs.split(', ').map(ref => ref.trim())\n  const tags = refsArray.filter(ref => ref.startsWith('tag: '))\n  if (!tags)\n    return []\n\n  return tags.map(tag => tag.replace('tag: ', '').trim())\n}\n\n/**\n * Generate RegExp for filtering out paths of commits.\n *\n * It follows the rules that:\n * - includes is not set, it is /^.+.md$/\n * - includeDirs is set, it is /^(${includeDirs.join('|')})\\/.+.md$/\n * - includeExtensions is set, it is /^.+(${includeExtensions.join('|')})$/\n * - in another word, /^(includeDir1|includeDir2)\\/.+(includeExtension1|includeExtensions2)$/\n *\n * @deprecated\n */\nexport function generateCommitPathsRegExp(includeDirs: string[], includeExtensions: `.${string}`[]): RegExp {\n  return new RegExp(`^${includeDirs.length > 0 ? `(${includeDirs.join('|')})${sep === win32.sep ? win32.sep : `\\\\${posix.sep}`}` : ''}.+${includeExtensions.length > 0 ? `(${includeExtensions.join('|')})` : '.md'}$`)\n}\n\nexport function getRelativePath(file: string, srcDir: string, cwd: string) {\n  cwd = normalizePath(cwd)\n  return file.replace(srcDir, '').replace(cwd, '').replace(/^\\//, '')\n}\n\nexport async function getRawCommitLogs(file: string, maxGitLogCount?: number) {\n  const fileDir = dirname(file)\n  const fileName = basename(file)\n  /**\n   * The format of git log.\n   *\n   * ${commit_hash} ${author_name} ${author_email} ${author_date} ${subject} ${ref} ${body}\n   *\n   * @see {@link https://git-scm.com/docs/pretty-formats | documentation} for details.\n   *\n   * Note: Make sure that `body` is in last position, as `\\n` or `|` in body may breaks subsequent processing.\n   *\n   * @example stdout\n   *\n   * ```bash\n   * $ git log --format=\"%H|%an|%ae|%ad|%s|%d|%b[GIT_LOG_COMMIT_END]\" --follow docs/pages/en/integrations/index.md\n   * 62ef7ed8f54ea1faeacf6f6c574df491814ec1b1|Neko Ayaka|neko@ayaka.moe|Wed Apr 24 14:24:44 2024 +0800|docs: fix english integrations list||Signed-off-by: Neko Ayaka <neko@ayaka.moe>\n   * [GIT_LOG_COMMIT_END]\n   * 34357cc0956db77d1fc597327ba880d7eebf67ce|Rizumu Ayaka|rizumu@ayaka.moe|Mon Apr 22 22:51:24 2024 +0800|release: pre-release v2.0.0-rc10| (tag: v2.0.0-rc10)|Signed-off-by: Rizumu Ayaka <rizumu@ayaka.moe>\n   * [GIT_LOG_COMMIT_END]\n   * (END)\n   * ```\n   */\n  const format = '%H|%an|%ae|%ad|%s|%d|%b'\n  const { stdout } = await execa('git', ['log', `--max-count=${maxGitLogCount ?? -1}`, `--format=${format}[GIT_LOG_COMMIT_END]`, '--follow', '--', fileName], { cwd: fileDir })\n  // remove \"[GIT_LOG_COMMIT_END]\" in last line: split stdout into lines and avoid empty strings\n  return stdout.replace(/\\[GIT_LOG_COMMIT_END\\]$/, '').split('[GIT_LOG_COMMIT_END]\\n')\n}\n\nexport function parseRawCommitLogs(\n  path: string,\n  rawLogs: string[],\n): RawCommit[] {\n  return rawLogs\n    .filter(log => !!log)\n    .map((raw) => {\n      const [hash, author_name, author_email, date, message, refs, body] = raw.split('|').map(v => v.trim())\n      return {\n        path,\n        hash,\n        date,\n        message,\n        body,\n        refs,\n        author_name,\n        author_email,\n      }\n    })\n}\n\nexport function mergeRawCommits(rawCommits: RawCommit[]): MergedRawCommit[] {\n  const commitMap = new Map<string, MergedRawCommit>()\n\n  rawCommits.forEach((commit) => {\n    const _commit = commitMap.get(commit.hash)\n    if (_commit)\n      _commit.paths.push(commit.path)\n    else\n      commitMap.set(commit.hash, { paths: [commit.path], ...omit(commit, ['path']) })\n  })\n\n  return Array.from(commitMap.values())\n}\n\nexport async function parseCommits(\n  rawCommits: MergedRawCommit[],\n  getRepoURL: CommitToStringHandler,\n  getCommitURL: CommitToStringHandler,\n  getReleaseTagURL: CommitToStringHandler,\n  getReleaseTagsURL: CommitToStringsHandler,\n  mapContributors?: Contributor[],\n  optsRewritePathsBy?: RewritePathsBy,\n): Promise<{ commits: Commit[], authors: CommitAuthor[] }> {\n  const allAuthors = new Map<string, CommitAuthor>()\n  const resolvedCommits = await Promise.all(rawCommits.map(async (rawCommit) => {\n    const { paths, hash, date, refs, message } = rawCommit\n\n    const resolvedCommit: Commit = {\n      paths,\n      hash,\n      date_timestamp: new Date(date).getTime(),\n      message,\n      authors: [],\n    }\n\n    // rewrite path\n    // Ensure that paths are processed first, as users may generate other properties based on this one.\n    if (typeof optsRewritePathsBy !== 'undefined')\n      await Promise.all(rawCommit.paths.map(async p => await rewritePathsByPatterns(resolvedCommit, p, optsRewritePathsBy)))\n\n    // repo url\n    resolvedCommit.repo_url = (await returnOrResolvePromise(getRepoURL(resolvedCommit))) ?? 'https://github.com/example/example'\n    // hash url\n    resolvedCommit.hash_url = (await returnOrResolvePromise(getCommitURL(resolvedCommit))) ?? defaultCommitURLHandler(resolvedCommit)\n\n    // remove `()` in refs, e.g. ` (tag: v2.0.0-rc7)`\n    const tags = parseGitLogRefsAsTags(refs?.replace(/[()]/g, ''))\n\n    // release logs\n    if (tags && tags.length > 0) {\n      resolvedCommit.tags = tags\n      resolvedCommit.tag = resolvedCommit.tags?.[0] || undefined\n      resolvedCommit.release_tag_url = (await returnOrResolvePromise(getReleaseTagURL(resolvedCommit))) ?? defaultReleaseTagURLHandler(resolvedCommit)\n      resolvedCommit.release_tags_url = (await returnOrResolvePromise(getReleaseTagsURL(resolvedCommit))) ?? defaultReleaseTagsURLHandler(resolvedCommit)\n    }\n\n    // authors\n    const authors = await parseCommitAuthors(rawCommit, mapContributors)\n    authors.forEach(a => allAuthors.set(a.name, omit(a, ['email'])))\n    resolvedCommit.authors = authors.map(a => a.name)\n\n    // generate author avatar based on md5 hash of email (gravatar style)\n    // resolvedCommit.author_avatar = await digestStringAsSHA256(rawCommit.author_email)\n\n    return resolvedCommit\n  }))\n\n  return { commits: resolvedCommits, authors: [...allAuthors.values()] }\n}\n\nexport async function parseCommitAuthors(commit: MergedRawCommit, mapContributors?: Contributor[]): Promise<CommitAuthor[]> {\n  const { author_name, author_email, body } = commit\n\n  const commitAuthor: CommitAuthor = {\n    name: author_name,\n    email: author_email,\n  }\n  const coAuthors = getCoAuthors(body)\n\n  return await Promise.all([commitAuthor, ...coAuthors]\n    // exclude bot users\n    .filter(v => !(v.name.match(/\\[bot\\]/i) || v.email?.match(/\\[bot\\]/i)))\n    // map authors\n    .map(async (author) => {\n      const targetCreatorByName = findMapAuthorByName(mapContributors, author.name)\n      if (targetCreatorByName) {\n        author.name = targetCreatorByName.name ?? author.name\n        author.i18n = findMapAuthorI18n(targetCreatorByName)\n        author.url = findMapAuthorLink(targetCreatorByName)\n        author.avatarUrl = await newAvatarForAuthor(targetCreatorByName, author.email!)\n        return author\n      }\n      const targetCreatorByEmail = author.email && findMapAuthorByEmail(mapContributors, author.email)\n      if (targetCreatorByEmail) {\n        author.name = targetCreatorByEmail.name ?? author.name\n        author.i18n = findMapAuthorI18n(targetCreatorByEmail)\n        author.url = findMapAuthorLink(targetCreatorByEmail)\n        author.avatarUrl = await newAvatarForAuthor(targetCreatorByEmail, author.email!)\n        return author\n      }\n      const targetCreatorByGitHub = findMapAuthorByGitHub(mapContributors, author.name, author.email!)\n      if (targetCreatorByGitHub) {\n        author.name = targetCreatorByGitHub.name ?? author.name\n        author.i18n = findMapAuthorI18n(targetCreatorByGitHub)\n        author.url = findMapAuthorLink(targetCreatorByGitHub)\n        author.avatarUrl = await newAvatarForAuthor(targetCreatorByGitHub, author.email!)\n        return author\n      }\n      author.avatarUrl = await newAvatarForAuthor(undefined, author.email!)\n      return author\n    }))\n}\n\n/**\n * This regular expression is used to match and parse commit messages that contain multiple author information.\n *\n * @see {@link https://regex101.com/r/q5YB8m/1 | Regexp demo}\n * @see {@link https://en.wikipedia.org/wiki/Email_address#Local-part | Email address}\n * @see {@link https://docs.github.com/en/pull-requests/committing-changes-to-your-project/creating-and-editing-commits/creating-a-commit-with-multiple-authors | Creating a commit with multiple authors in GitHub}\n */\nconst multipleAuthorsRegex = /^ *Co-authored-by: ?([^<]*)<([^>]*)> */gim\n\n// This function handles multiple authors in a commit.\n// It uses the regular expression to extract the name and email of each author from the commit message.\n// About the docs: https://docs.github.com/en/pull-requests/committing-changes-to-your-project/creating-and-editing-commits/creating-a-commit-with-multiple-authors\nexport function getCoAuthors(body?: string): CommitAuthor[] {\n  if (!body)\n    return []\n\n  return [...body.matchAll(multipleAuthorsRegex)].map((result) => {\n    const [, name, email] = result\n    return {\n      name: name.trim(),\n      email: email.trim(),\n    }\n  }).filter(v => !!v)\n}\n\nexport function findMapAuthorByName(mapContributors: Contributor[] | undefined, author_name: string) {\n  return mapContributors?.find((item) => {\n    const res = (item.mapByNameAliases && Array.isArray(item.mapByNameAliases) && item.mapByNameAliases.includes(author_name)) || item.name === author_name || item.username === author_name\n    if (res)\n      return true\n\n    // This is a fallback for the old version of the configuration.\n    return item.nameAliases && Array.isArray(item.nameAliases) && item.nameAliases.includes(author_name)\n  })\n}\n\nexport function findMapAuthorByEmail(mapContributors: Contributor[] | undefined, author_email: string) {\n  return mapContributors?.find((item) => {\n    const res = item.mapByEmailAliases && Array.isArray(item.mapByEmailAliases) && item.mapByEmailAliases.includes(author_email)\n    if (res)\n      return true\n\n    // This is a fallback for the old version of the configuration.\n    return item.emailAliases && Array.isArray(item.emailAliases) && item.emailAliases.includes(author_email)\n  })\n}\n\nexport function findMapAuthorByGitHub(mapContributors: Contributor[] | undefined, author_name: string, author_email: string) {\n  const github = getGitHubUserNameFromNoreplyAddress(author_email)\n  if (github && github.userName) {\n    const mappedByName = findMapAuthorByName(mapContributors, github.userName)\n    if (mappedByName && mappedByName.username) {\n      mappedByName.username ||= github.userName\n      return mappedByName\n    }\n    return {\n      name: author_name,\n      username: github.userName,\n    }\n  }\n}\n\nexport function findMapAuthorLink(creator: Contributor): string | undefined {\n  if (!creator.links && !!creator.username)\n    return `https://github.com/${creator.username}`\n\n  if (typeof creator.links === 'string' && !!creator.links)\n    return creator.links\n  if (!Array.isArray(creator.links))\n    return\n\n  const priority = ['github', 'twitter']\n  for (const p of priority) {\n    const matchedEntry = creator.links?.find(l => l.type === p)\n    if (matchedEntry)\n      return matchedEntry.link\n  }\n\n  return creator.links?.[0]?.link\n}\n\nexport function findMapAuthorI18n(mappedAuthor: Contributor): Record<string, string> | undefined {\n  if (mappedAuthor && mappedAuthor.i18n) {\n    return mappedAuthor.i18n\n  }\n  return undefined\n}\n\n// based on https://github.com/nolebase/integrations/issues/277#issuecomment-2254111802\nexport function getGitHubUserNameFromNoreplyAddress(email: string) {\n  const match = email.match(/^(?:(?<userId>\\d+)\\+)?(?<userName>[a-zA-Z\\d-]{1,39})@users.noreply.github.com$/)\n  if (!match || !match.groups)\n    return undefined\n\n  const { userName, userId } = match.groups\n  return { userId, userName }\n}\n\nexport async function newAvatarForAuthor(mappedAuthor: Contributor | undefined, email: string): Promise<string> {\n  if (mappedAuthor) {\n    if (mappedAuthor.avatar)\n      return mappedAuthor.avatar\n    if (mappedAuthor.username)\n      return `https://github.com/${mappedAuthor.username}.png`\n  }\n\n  return `https://gravatar.com/avatar/${await digestStringAsSHA256(email)}?d=retro`\n}\n","import type { Plugin, ResolvedConfig } from 'vite'\nimport type { SiteConfig } from 'vitepress'\n\nimport type { Author, Changelog } from '../types'\nimport type { CommitToStringHandler, CommitToStringsHandler, RewritePathsBy } from './helpers'\nimport type { GitChangelogOptions } from './types'\n\nimport { join } from 'node:path'\nimport { cwd as _cwd } from 'node:process'\n\nimport { cyan, gray } from 'colorette'\nimport { execa } from 'execa'\nimport { globby } from 'globby'\nimport { normalizePath } from 'vite'\n\nimport {\n\n  defaultCommitURLHandler,\n  defaultReleaseTagsURLHandler,\n  defaultReleaseTagURLHandler,\n  getRawCommitLogs,\n  getRelativePath,\n  mergeRawCommits,\n  parseCommits,\n  parseRawCommitLogs,\n\n  rewritePathsByRewritingExtension,\n} from './helpers'\n\nexport type {\n  Author,\n  CommitToStringHandler,\n  CommitToStringsHandler,\n  RewritePathsBy,\n}\n\nexport {\n  rewritePathsByRewritingExtension,\n}\n\ninterface VitePressConfig extends ResolvedConfig {\n  vitepress: SiteConfig\n}\n\nconst VirtualModuleID = 'virtual:nolebase-git-changelog'\nconst ResolvedVirtualModuleId = `\\0${VirtualModuleID}`\n\nconst logModulePrefix = `${cyan(`@nolebase/vitepress-plugin-git-changelog`)}${gray(':')}`\nconst logger = console\n\nexport function GitChangelog(options: GitChangelogOptions = {}): Plugin {\n  if (!options)\n    options = {}\n\n  const {\n    cwd = _cwd(),\n    maxGitLogCount,\n    include = ['**/*.md', '!node_modules'],\n    mapAuthors,\n    repoURL = 'https://github.com/example/example',\n    getReleaseTagURL = defaultReleaseTagURLHandler,\n    getReleaseTagsURL = defaultReleaseTagsURLHandler,\n    getCommitURL = defaultCommitURLHandler,\n    rewritePathsBy,\n  } = options\n\n  const getRepoURL = typeof repoURL === 'function' ? repoURL : () => repoURL\n\n  const changelog: Changelog = { commits: [], authors: [] }\n  const hotModuleReloadCachedCommits = new Map<string, Changelog>()\n  let srcDir = ''\n  let config: VitePressConfig\n\n  const commitFromPath = async (paths: string[]) => {\n    const rawCommits = (await Promise.all(paths.map(async (path) => {\n      const rawLogs = await getRawCommitLogs(path, maxGitLogCount)\n      const relativePath = getRelativePath(path, srcDir, cwd)\n      const rawCommits = parseRawCommitLogs(relativePath, rawLogs)\n      return rawCommits\n    }))).flat()\n    const mergedRawCommits = mergeRawCommits(rawCommits)\n    const resolvedCommits = parseCommits(\n      mergedRawCommits,\n      getRepoURL,\n      getCommitURL,\n      getReleaseTagURL,\n      getReleaseTagsURL,\n      mapAuthors,\n      rewritePathsBy,\n    )\n    return resolvedCommits\n  }\n\n  return {\n    name: '@nolebase/vitepress-plugin-git-changelog',\n    config: () => ({\n      optimizeDeps: {\n        exclude: [\n          '@nolebase/vitepress-plugin-git-changelog/client',\n        ],\n      },\n      ssr: {\n        noExternal: [\n          '@nolebase/vitepress-plugin-git-changelog',\n          // @nolebase/ui required here as noExternal to avoid the following error:\n          // TypeError [ERR_UNKNOWN_FILE_EXTENSION]: Unknown file extension \".vue\" for ...\n          // Read more here: https://github.com/vuejs/vitepress/issues/2915\n          // And here: https://stackblitz.com/edit/vite-gjz9zf?file=docs%2F.vitepress%2Fconfig.ts\n          '@nolebase/ui',\n        ],\n      },\n    }),\n    configResolved(_config) {\n      config = _config as VitePressConfig\n      srcDir = config.vitepress.srcDir\n    },\n    async buildStart() {\n      if (config.command !== 'build')\n        return\n\n      const startsAt = Date.now()\n      logger.info(`${logModulePrefix} Prepare to gather git logs...`)\n\n      if (changelog.commits.length > 0)\n        return\n\n      // configure so that the git log messages can contain correct CJK characters\n      await execa('git', ['config', '--local', 'core.quotepath', 'false'])\n\n      const paths = await globby(include, {\n        gitignore: true,\n        cwd,\n        absolute: true,\n      })\n\n      Object.assign(changelog, await commitFromPath(paths))\n\n      const elapsed = Date.now() - startsAt\n      logger.info(`${logModulePrefix} Done. ${gray(`(${elapsed}ms)`)}`)\n    },\n    resolveId(source) {\n      if (source.startsWith(VirtualModuleID))\n        return `\\0${source}`\n    },\n    load(id) {\n      if (!id.startsWith(ResolvedVirtualModuleId))\n        return null\n\n      return `export default ${JSON.stringify(changelog, null, config.isProduction ? 0 : 2)}`\n    },\n    configureServer(server) {\n      compatibleConfigureServer(server, (_, env) => {\n        env.hot.on('nolebase-git-changelog:client-mounted', async (data) => {\n          if (!data || typeof data !== 'object')\n            return\n          if (!('page' in data && 'filePath' in data.page))\n            return\n\n          let result = hotModuleReloadCachedCommits.get(data.page.filePath)\n          if (!result) {\n            const path = normalizePath(join(srcDir, data.page.filePath))\n            result = await commitFromPath([path])\n            hotModuleReloadCachedCommits.set(data.page.filePath, result)\n          }\n\n          Object.assign(changelog, result)\n\n          if (!result!.commits.length)\n            return\n\n          const virtualModule = env.moduleGraph.getModuleById(ResolvedVirtualModuleId)\n          if (!virtualModule)\n            return\n\n          env.moduleGraph.invalidateModule(virtualModule)\n          env.hot.send({\n            type: 'custom',\n            event: 'nolebase-git-changelog:updated',\n            data: changelog,\n          })\n        })\n      })\n    },\n  }\n}\n\ninterface Environment {\n  hot: {\n    on: (event: string, handler: (data: any) => void) => void\n    send: (data: any) => void\n  }\n  moduleGraph: {\n    getModuleById: (id: string) => any\n    invalidateModule: (module: any) => void\n  }\n}\n\nfunction compatibleConfigureServer<E extends Environment>(server: E, registerHandler: (name: string, env: E) => void | Promise<void>) {\n// Temporary workaround for Vite 5, both register for environments and server\n  // When VitePress is upgraded to Vite 6, this can be removed\n  if ('environments' in server && typeof server.environments === 'object' && server.environments != null) {\n    Object.entries(server.environments).forEach(([name, env]) => registerHandler(name, env))\n  }\n  else {\n    registerHandler('server', server)\n  }\n}\n","import type { Plugin } from 'vite'\n\nimport type { Context, GitChangelogMarkdownSectionOptions } from './types'\n\nimport { relative } from 'node:path'\n\nimport GrayMatter from 'gray-matter'\n\nimport { createHelpers } from './helpers'\n\nexport type {\n  Context,\n  GitChangelogMarkdownSectionOptions,\n}\n\nexport function GitChangelogMarkdownSection(options?: GitChangelogMarkdownSectionOptions): Plugin {\n  const {\n    excludes = ['index.md'],\n    exclude = () => false,\n  } = options ?? {}\n\n  let root = ''\n\n  return {\n    name: '@nolebase/vitepress-plugin-git-changelog-markdown-section',\n    // May set to 'pre' since end user may use vitepress wrapped vite plugin to\n    // specify the plugins, which may cause this plugin to be executed after\n    // vitepress or the other markdown processing plugins.\n    enforce: 'pre',\n    configResolved(config) {\n      root = config.root ?? ''\n    },\n    transform(code, id) {\n      if (!id.endsWith('.md'))\n        return null\n\n      const helpers = createHelpers(root, id)\n\n      if (excludes.includes(relative(root, id)))\n        return null\n      if (exclude(id, { helpers }))\n        return null\n\n      const parsedMarkdownContent = GrayMatter(code)\n\n      if ('nolebase' in parsedMarkdownContent.data && 'gitChangelog' in parsedMarkdownContent.data.nolebase && !parsedMarkdownContent.data.nolebase.gitChangelog)\n        return null\n      if ('gitChangelog' in parsedMarkdownContent.data && !parsedMarkdownContent.data.gitChangelog)\n        return null\n\n      if (!options?.sections?.disableContributors)\n        code = TemplateContributors(code)\n      if (!options?.sections?.disableChangelog)\n        code = TemplateChangelog(code)\n\n      return code\n    },\n  }\n}\n\nfunction TemplateContributors(code: string) {\n  return `${code}\n\n<NolebaseGitContributors />\n`\n}\n\nfunction TemplateChangelog(code: string) {\n  return `${code}\n\n<NolebaseGitChangelog />\n`\n}\n"],"names":["normalizePath","relative","subtle","extname","dirname","basename","execa","omit","cyan","gray","_cwd","rawCommits","globby","join","GrayMatter"],"mappings":"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"}