"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_utils=require("../../ui/src/utils"),_dom=require("../../ui/src/dom"),_vn=require("../../ui/src/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_comp.defineVxeComponent)({name:"VxeTooltip",props:{modelValue:Boolean,size:{type:String,default:()=>(0,_ui.getConfig)().tooltip.size||(0,_ui.getConfig)().size},selector:String,trigger:{type:String,default:()=>(0,_ui.getConfig)().tooltip.trigger||"hover"},theme:{type:String,default:()=>(0,_ui.getConfig)().tooltip.theme||"dark"},content:{type:[String,Number],default:null},useHTML:Boolean,zIndex:[String,Number],popupClassName:[String,Function],width:{type:[String,Number],default:()=>(0,_ui.getConfig)().tooltip.Width},height:{type:[String,Number],default:()=>(0,_ui.getConfig)().tooltip.height},minWidth:{type:[String,Number],default:()=>(0,_ui.getConfig)().tooltip.minWidth},minHeight:{type:[String,Number],default:()=>(0,_ui.getConfig)().tooltip.minHeight},maxWidth:{type:[String,Number],default:()=>(0,_ui.getConfig)().tooltip.maxWidth},maxHeight:{type:[String,Number],default:()=>(0,_ui.getConfig)().tooltip.maxHeight},isArrow:{type:Boolean,default:()=>(0,_ui.getConfig)().tooltip.isArrow},enterable:{type:Boolean,default:()=>(0,_ui.getConfig)().tooltip.enterable},enterDelay:{type:Number,default:()=>(0,_ui.getConfig)().tooltip.enterDelay},leaveDelay:{type:Number,default:()=>(0,_ui.getConfig)().tooltip.leaveDelay}},emits:["update:modelValue"],setup(p,e){const{slots:d,emit:r}=e;var t=_xeUtils.default.uniqueId();const v=(0,_ui.useSize)(p)["computeSize"],g=(0,_vue.reactive)({target:null,isUpdate:!1,visible:!1,tipContent:"",tipActive:!1,tipTarget:null,tipZindex:0,tipStore:{style:{},placement:"",arrowStyle:{}}}),n={},c=(0,_vue.ref)(),m=(0,_vue.ref)(),f=(0,_vue.computed)(()=>{var{width:e,height:t,minHeight:i,minWidth:r,maxHeight:o,maxWidth:n}=p,l={};return e&&(l.width=(0,_dom.toCssUnit)(e)),t&&(l.height=(0,_dom.toCssUnit)(t)),r&&(l.minWidth=(0,_dom.toCssUnit)(r)),i&&(l.minHeight=(0,_dom.toCssUnit)(i)),n&&(l.maxWidth=(0,_dom.toCssUnit)(n)),o&&(l.maxHeight=(0,_dom.toCssUnit)(o)),l}),i={refElem:c},_={xID:t,props:p,context:e,reactData:g,internalData:n,getRefMaps:()=>i};let o={};const l=()=>{var{tipTarget:i,tipStore:r}=g;if(i){var{scrollTop:o,scrollLeft:n,visibleWidth:l}=(0,_dom.getDomNode)(),{top:a,left:u}=(0,_dom.getAbsolutePos)(i),s=c.value;if(s){var p=s.offsetHeight,s=s.offsetWidth;let e=u,t=a-p-6;(e=Math.max(6,u+Math.floor((i.offsetWidth-s)/2)))+s+6>n+l&&(e=n+l-s-6),a-p<o+6&&(r.placement="bottom",t=a+i.offsetHeight+6),r.style.top=t+"px",r.style.left=e+"px",r.arrowStyle.left=u-e+i.offsetWidth/2+"px"}}},a=e=>{e!==g.visible&&(g.visible=e,g.isUpdate=!0,r("update:modelValue",e))},u=()=>{g.tipZindex<(0,_utils.getLastZIndex)()&&(g.tipZindex=(0,_utils.nextZIndex)())},s=()=>{g.visible?o.close():w(g.target||N(),p.content)},h=()=>{w(g.target||N(),p.content)},x=()=>{var{trigger:e,enterable:t,leaveDelay:i}=p;g.tipActive=!1,t&&"hover"===e?setTimeout(()=>{g.tipActive||o.close()},i):o.close()},y=()=>{g.tipActive=!0},b=()=>{var{trigger:e,enterable:t,leaveDelay:i}=p;g.tipActive=!1,t&&"hover"===e&&setTimeout(()=>{g.tipActive||o.close()},i)},C=()=>{var e=g["tipStore"],t=c.value;return t&&!t.parentNode&&document.body.appendChild(t),a(!0),u(),e.placement="top",e.style={width:"auto",left:0,top:0,zIndex:p.zIndex||g.tipZindex},e.arrowStyle={left:"50%"},o.updatePlacement()},S=()=>{n.showDelayTip=_xeUtils.default.debounce(()=>{g.tipActive&&C()},p.enterDelay,{leading:!1,trailing:!0})},w=(e,t)=>{var i=d.content;if((i||""!==t&&!_xeUtils.default.eqNull(t))&&e){var i=n["showDelayTip"],{trigger:r,enterDelay:o}=p;if(g.tipActive=!0,g.tipTarget=e,g.tipContent=t,!o||"hover"!==r)return C();i&&i()}return(0,_vue.nextTick)()},N=()=>{var e=p["selector"];if(e){if(_xeUtils.default.isElement(e))return e;if(_xeUtils.default.isString(e))return document.querySelector(e)}return null},T=(o={dispatchEvent(e,t,i){r(e,(0,_ui.createEvent)(i,{$tooltip:_},t))},open(e,t){return w(e||g.target||N(),t)},close(){return g.tipTarget=null,g.tipActive=!1,Object.assign(g.tipStore,{style:{},placement:"",arrowStyle:null}),a(!1),(0,_vue.nextTick)()},toVisible(e,t){return w(e,t)},updatePlacement(){return(0,_vue.nextTick)().then(()=>{var e=g["tipTarget"],t=c.value;if(e&&t)return l(),(0,_vue.nextTick)().then(()=>{l()})})},isActived(){return g.tipActive},setActived(e){g.tipActive=!!e}},e=>{e.stopPropagation()});Object.assign(_,o);return(0,_vue.watch)(()=>p.enterDelay,()=>{S()}),(0,_vue.watch)(()=>p.content,e=>{g.tipContent=e}),(0,_vue.watch)(()=>p.modelValue,e=>{g.isUpdate||(e?w(g.target||N(),p.content):o.close()),g.isUpdate=!1}),(0,_vue.onMounted)(()=>{var e=m.value;e&&e.addEventListener("wheel",T,{passive:!1}),(0,_vue.nextTick)(()=>{var e,{trigger:t,content:i}=p;const r=c.value;if(r){const o=r.parentNode;o&&(g.tipContent=i,g.tipZindex=(0,_utils.nextZIndex)(),_xeUtils.default.arrayEach(r.children,(e,t)=>{1<t&&(o.insertBefore(e,r),g.target||(g.target=e))}),o.removeChild(r),e=g["target"],e&&("hover"===t?(e.onmouseenter=h,e.onmouseleave=x):"click"===t&&(e.onclick=s)),p.modelValue)&&w(e||N(),i)}})}),(0,_vue.onBeforeUnmount)(()=>{var e=g["target"],t=c.value,e=(e&&(e.onmouseenter=null,e.onmouseleave=null,e.onclick=null),m.value);e&&e.removeEventListener("wheel",T),t&&(e=t.parentNode)&&e.removeChild(t)}),S(),_.renderVN=()=>{var{popupClassName:e,theme:t,isArrow:i,enterable:r}=p,{tipActive:o,visible:n,tipStore:l}=g,a=d.default,u=v.value;let s;return r&&(s={onMouseenter:y,onMouseleave:b}),(0,_vue.h)("div",Object.assign({ref:c,class:["vxe-tooltip--wrapper","theme--"+t,e?_xeUtils.default.isFunction(e)?e({$tooltip:_}):e:"",{["size--"+u]:u,["placement--"+l.placement]:l.placement,"is--enterable":r,"is--visible":n,"is--arrow":i,"is--active":o}],style:l.style},s),[(t=p.useHTML,e=g.tipContent,u=f.value,r=d.content,(n=[]).push(r?(0,_vue.h)("div",{key:1},(0,_vn.getSlotVNs)(r({}))):t?(0,_vue.h)("div",{key:2,innerHTML:e}):(0,_vue.h)("span",{key:3},""+e)),(0,_vue.h)("div",{key:3,ref:m,class:"vxe-tooltip--content",style:u},n)),(0,_vue.h)("div",{class:"vxe-tooltip--arrow",style:l.arrowStyle}),...a?(0,_vn.getSlotVNs)(a({})):[]])},_},render(){return this.renderVN()}});