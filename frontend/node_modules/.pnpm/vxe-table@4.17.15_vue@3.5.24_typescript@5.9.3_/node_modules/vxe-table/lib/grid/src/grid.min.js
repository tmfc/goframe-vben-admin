Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_utils=require("../../ui/src/utils"),_dom=require("../../ui/src/dom"),_ui=require("../../ui"),_props=require("./props"),_emits=require("./emits"),_vn=require("../../ui/src/vn"),_log=require("../../ui/src/log"),_emits2=require("../../table/src/emits"),_props2=require("../../table/src/props"),_table=_interopRequireDefault(require("../../table/src/table")),_toolbar=_interopRequireDefault(require("../../toolbar/src/toolbar"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let{getConfig,getI18n,commands,hooks,useFns,createEvent,globalEvents,GLOBAL_EVENT_KEYS,renderEmptyElement}=_ui.VxeUI,tableComponentPropKeys=Object.keys(_props2.tableProps),tableComponentMethodKeys=["clearAll","syncData","updateData","loadData","reloadData","reloadRow","loadColumn","reloadColumn","getRowNode","getColumnNode","getRowIndex","getVTRowIndex","getVMRowIndex","getColumnIndex","getVTColumnIndex","getVMColumnIndex","setRow","createData","createRow","revertData","clearData","isRemoveByRow","isInsertByRow","isUpdateByRow","getColumns","getColumnById","getColumnByField","getTableColumn","getFullColumns","getData","getCheckboxRecords","getParentRow","getTreeRowChildren","getTreeRowLevel","getTreeParentRow","getRowSeq","getRowById","getRowid","getTableData","getFullData","setColumnFixed","clearColumnFixed","setColumnWidth","getColumnWidth","recalcRowHeight","setRowHeightConf","getRowHeightConf","setRowHeight","getRowHeight","hideColumn","showColumn","resetColumn","refreshColumn","refreshScroll","recalculate","closeTooltip","isAllCheckboxChecked","isAllCheckboxIndeterminate","getCheckboxIndeterminateRecords","setCheckboxRow","setCheckboxRowKey","isCheckedByCheckboxRow","isCheckedByCheckboxRowKey","isIndeterminateByCheckboxRow","isIndeterminateByCheckboxRowKey","toggleCheckboxRow","setAllCheckboxRow","getRadioReserveRecord","clearRadioReserve","getCheckboxReserveRecords","clearCheckboxReserve","toggleAllCheckboxRow","clearCheckboxRow","setCurrentRow","isCheckedByRadioRow","isCheckedByRadioRowKey","setRadioRow","setRadioRowKey","clearCurrentRow","clearRadioRow","getCurrentRecord","getRadioRecord","getCurrentColumn","setCurrentColumn","clearCurrentColumn","setPendingRow","togglePendingRow","hasPendingByRow","isPendingByRow","getPendingRecords","clearPendingRow","setFilterByEvent","sort","setSort","setSortByEvent","clearSort","clearSortByEvent","isSort","getSortColumns","closeFilter","isFilter","clearFilterByEvent","isActiveFilterByColumn","isRowExpandLoaded","clearRowExpandLoaded","reloadRowExpand","reloadRowExpand","toggleRowExpand","setAllRowExpand","setRowExpand","isExpandByRow","isRowExpandByRow","clearRowExpand","clearRowExpandReserve","getRowExpandRecords","getTreeExpandRecords","isTreeExpandLoaded","clearTreeExpandLoaded","reloadTreeExpand","reloadTreeChilds","toggleTreeExpand","setAllTreeExpand","setTreeExpand","isTreeExpandByRow","clearTreeExpand","clearTreeExpandReserve","getScroll","getScrollData","scrollTo","scrollToRow","scrollToColumn","clearScroll","updateFooter","updateStatus","setMergeCells","removeInsertRow","removeMergeCells","getMergeCells","setMergeHeaderCells","removeMergeHeaderCells","getMergeHeaderCells","clearMergeHeaderCells","clearMergeCells","setMergeFooterItems","removeMergeFooterItems","getMergeFooterItems","clearMergeFooterItems","getCustomStoreData","setRowGroupExpand","setRowGroupExpandByField","setAllRowGroupExpand","clearRowGroupExpand","isRowGroupExpandByRow","isRowGroupRecord","isAggregateRecord","isAggregateExpandByRow","getAggregateContentByRow","getAggregateRowChildren","setRowGroups","clearRowGroups","openTooltip","moveColumnTo","moveRowTo","getCellLabel","getCellElement","focus","blur","connect","connectToolbar"];function createInternalData(){return{}}var _default=exports.default=(0,_comp.defineVxeComponent)({name:"VxeGrid",props:_props.gridProps,emits:_emits.gridEmits,setup(d,e){let t,{slots:c,emit:a}=e;var r=_xeUtils.default.uniqueId();let n=_ui.VxeUI.getComponent("VxeForm"),l=_ui.VxeUI.getComponent("VxePager"),k=[["Form"],["Toolbar","Top","Table","Bottom","Pager"]],I=useFns.useSize(d).computeSize,$=(0,_vue.reactive)({tableLoading:!1,proxyInited:!1,isZMax:!1,tableData:[],filterData:[],formData:{},sortData:[],tZindex:0,tablePage:{total:0,pageSize:(null==(t=getConfig().pager)?void 0:t.pageSize)||10,currentPage:1}}),o=createInternalData(),g=(0,_vue.ref)(),M=(0,_vue.ref)(),i=(0,_vue.ref)(),u=(0,_vue.ref)(),s=(0,_vue.ref)(),v=(0,_vue.ref)(),m=(0,_vue.ref)(),p=(0,_vue.ref)(),f=(0,_vue.ref)(),x=(0,_vue.ref)(),b=(0,_vue.ref)();var _=e=>{let t={};return e.forEach(r=>{t[r]=(...e)=>{var t=M.value;if(t&&t[r])return t[r](...e)}}),t};let h=_(tableComponentMethodKeys),F=(tableComponentMethodKeys.forEach(r=>{h[r]=(...e)=>{var t=M.value;if(t&&t[r])return t&&t[r](...e)}}),(0,_vue.computed)(()=>_xeUtils.default.merge({},_xeUtils.default.clone(getConfig().grid.proxyConfig,!0),d.proxyConfig))),z=(0,_vue.computed)(()=>{var e=F.value;return!!(_xeUtils.default.isBoolean(e.message)?e.message:e.showResponseMsg)}),D=(0,_vue.computed)(()=>{var e=F.value;return _xeUtils.default.isBoolean(e.showActionMsg)?e.showActionMsg:!!e.showActiveMsg}),j=(0,_vue.computed)(()=>Object.assign({},getConfig().grid.pagerConfig,d.pagerConfig)),C=(0,_vue.computed)(()=>Object.assign({},getConfig().grid.formConfig,d.formConfig)),B=(0,_vue.computed)(()=>Object.assign({},getConfig().grid.toolbarConfig,d.toolbarConfig)),y=(0,_vue.computed)(()=>Object.assign({},getConfig().grid.zoomConfig,d.zoomConfig)),T=(0,_vue.computed)(()=>{var{height:e,maxHeight:t}=d,{isZMax:r,tZindex:a}=$,o={};return r?o.zIndex=a:(e&&(o.height="auto"===e||"100%"===e?"100%":(0,_dom.toCssUnit)(e)),t&&(o.maxHeight="auto"===t||"100%"===t?"100%":(0,_dom.toCssUnit)(t))),o}),U=(0,_vue.computed)(()=>{let t={};return tableComponentPropKeys.forEach(e=>{t[e]=d[e]}),t}),S=(0,_vue.computed)(()=>{var{seqConfig:e,pagerConfig:t,editConfig:r,proxyConfig:a}=d,{isZMax:o,tablePage:l}=$,n=U.value,i=F.value,s=j.value,u=G.value,g=Object.assign({},n);return o&&(n.maxHeight?g.maxHeight="100%":g.height="100%"),a&&(0,_utils.isEnableConf)(i)&&(g.loading=u,t)&&i.seq&&(0,_utils.isEnableConf)(s)&&(g.seqConfig=Object.assign({},e,{startIndex:(l.currentPage-1)*l.pageSize})),r&&(g.editConfig=Object.assign({},r)),g}),O=(0,_vue.computed)(()=>{var e=d.layouts;let t=[],r=[],a=[],o=[];return(t=e&&e.length?e:getConfig().grid.layouts||k).length&&(_xeUtils.default.isArray(t[0])?(r=t[0],a=t[1]||[],o=t[2]||[]):a=t),{headKeys:r,bodyKeys:a,footKeys:o}});var A=(0,_vue.computed)(()=>j.value.currentPage),H=(0,_vue.computed)(()=>j.value.pageSize),Z=(0,_vue.computed)(()=>j.value.total);let K=(0,_vue.computed)(()=>{var e=$.tablePage;return Math.max(Math.ceil(e.total/e.pageSize),1)}),G=(0,_vue.computed)(()=>{var{loading:e,proxyConfig:t}=d,r=$.tableLoading,a=F.value,o=a.showLoading;return e||r&&o&&t&&(0,_utils.isEnableConf)(a)}),N={refElem:g,refTable:M,refForm:i,refToolbar:u,refPager:s,refPopupContainerElem:v},Q={computeProxyOpts:F,computePagerOpts:j,computeFormOpts:C,computeToolbarOpts:B,computeZoomOpts:y},q={xID:r,props:d,context:e,reactData:$,internalData:o,getRefMaps:()=>N,getComputeMaps:()=>Q},W=()=>{var e=B.value;d.toolbarConfig&&(0,_utils.isEnableConf)(e)&&(0,_vue.nextTick)(()=>{var e=M.value,t=u.value;e&&t&&e.connectToolbar(t)})},L=()=>{var e=d.proxyConfig,t=$.formData,r=F.value,a=C.value;return e&&(0,_utils.isEnableConf)(r)&&r.form?t:a.data},E=e=>{var t=$.tablePage,r=d.pagerConfig,a=j.value;r&&(0,_utils.isEnableConf)(a)&&(e?a[e]&&(t[e]=_xeUtils.default.toNumber(a[e])):({currentPage:r,pageSize:e,total:a}=a,r&&(t.currentPage=r),e&&(t.pageSize=e),a&&(t.total=a)))},V=(e,t)=>{var r=F.value,r=(r.response||r.props||{}).message,a=M.value;let o;return(o=e&&r?_xeUtils.default.isFunction(r)?r({data:e,$table:a,$grid:q,$gantt:null}):_xeUtils.default.get(e,r):o)||getI18n(t)},Y=(e,t,r)=>{var a=D.value,o=q.getCheckboxRecords();if(a)if(o.length){if(_ui.VxeUI.modal)return _ui.VxeUI.modal.confirm({id:"cfm_"+e,content:getI18n(t),escClosable:!0}).then(e=>{if("confirm"===e)return r()})}else _ui.VxeUI.modal&&_ui.VxeUI.modal.message({id:"msg_"+e,content:getI18n("vxe.grid.selectOneRecord"),status:"warning"});else o.length&&r();return Promise.resolve()},J=e=>{var t=d.proxyConfig,r=$.tablePage;let{$event:a,currentPage:o,pageSize:l}=e;var n=F.value;r.currentPage=o,r.pageSize=l,q.dispatchEvent("page-change",e,a),t&&(0,_utils.isEnableConf)(n)&&q.commitProxy("query").then(e=>{q.dispatchEvent("proxy-query",e,a)})},X=t=>{var e,r=M.value,a=d.proxyConfig;r&&(r=r.getComputeMaps().computeSortOpts,e=F.value,r.value.remote)&&($.sortData=t.sortList,a)&&(0,_utils.isEnableConf)(e)&&($.tablePage.currentPage=1,q.commitProxy("query").then(e=>{q.dispatchEvent("proxy-query",e,t.$event)}))},ee=e=>{X(e),q.dispatchEvent("sort-change",e,e.$event)},te=e=>{X(e),q.dispatchEvent("clear-all-sort",e,e.$event)},re=t=>{var e,r=M.value,a=d.proxyConfig;r&&(r=r.getComputeMaps().computeFilterOpts,e=F.value,r.value.remote)&&($.filterData=t.filterList,a)&&(0,_utils.isEnableConf)(e)&&($.tablePage.currentPage=1,q.commitProxy("query").then(e=>{q.dispatchEvent("proxy-query",e,t.$event)}))},ae=e=>{re(e),q.dispatchEvent("filter-change",e,e.$event)},oe=e=>{re(e),q.dispatchEvent("clear-all-filter",e,e.$event)},le=t=>{var e=d.proxyConfig,r=F.value;$.tableLoading||(e&&(0,_utils.isEnableConf)(r)&&q.commitProxy("reload").then(e=>{q.dispatchEvent("proxy-query",Object.assign(Object.assign({},e),{isReload:!0}),t.$event)}),q.dispatchEvent("form-submit",t,t.$event))},ne=e=>{var t=M.value,r=d.proxyConfig;let a=e.$event;var o=F.value;r&&(0,_utils.isEnableConf)(o)&&(t&&t.clearScroll(),q.commitProxy("reload").then(e=>{q.dispatchEvent("proxy-query",Object.assign(Object.assign({},e),{isReload:!0}),a)})),q.dispatchEvent("form-reset",e,a)},ie=e=>{q.dispatchEvent("form-submit-invalid",e,e.$event)},se=e=>{var t=e.$event;q.dispatchEvent("form-toggle-collapse",e,t),q.dispatchEvent("form-collapse",e,t)},ue=e=>{var t=$.isZMax;return(e?!t:t)&&($.isZMax=!t,$.tZindex<(0,_utils.getLastZIndex)())&&($.tZindex=(0,_utils.nextZIndex)()),(0,_vue.nextTick)().then(()=>q.recalculate(!0)).then(()=>(setTimeout(()=>q.recalculate(!0),15),$.isZMax))},R=(e,t)=>{e=e[t];if(e){if(!_xeUtils.default.isString(e))return e;if(c[e])return c[e];(0,_log.errLog)("vxe.error.notSlot",["[grid] "+e])}return null},ge=e=>{let r={};return _xeUtils.default.objectMap(e,(e,t)=>{e&&(_xeUtils.default.isString(e)?c[e]?r[t]=c[e]:(0,_log.errLog)("vxe.error.notSlot",["[grid] "+e]):r[t]=e)}),r},de=()=>{var{formConfig:e,proxyConfig:r}=d,a=$.formData,o=F.value,l=C.value;if(e&&(0,_utils.isEnableConf)(l)||c.form){let e=[];if(c.form)e=c.form({$grid:q,$gantt:null});else if(l.items){let t={};if(!l.inited){l.inited=!0;let t=o.beforeItem;o&&t&&l.items.forEach(e=>{t({$grid:q,$gantt:null,item:e})})}l.items.forEach(e=>{_xeUtils.default.each(e.slots,e=>{_xeUtils.default.isFunction(e)||c[e]&&(t[e]=c[e])})}),n&&e.push((0,_vue.h)(n,Object.assign(Object.assign({ref:i},Object.assign({},l,{data:r&&(0,_utils.isEnableConf)(o)&&o.form?a:l.data})),{onSubmit:le,onReset:ne,onSubmitInvalid:ie,onCollapse:se}),t))}return(0,_vue.h)("div",{ref:m,key:"form",class:"vxe-grid--form-wrapper"},e)}return renderEmptyElement(q)},ce=()=>{var t,r,a,o,l,n=d.toolbarConfig,i=B.value,s=c.toolbar;if(n&&(0,_utils.isEnableConf)(i)||s){let e=[];return s?e=s({$grid:q,$gantt:null}):(n={},(s=i.slots)&&(t=R(s,"buttons"),r=R(s,"buttonPrefix"),a=R(s,"buttonSuffix"),o=R(s,"tools"),l=R(s,"toolPrefix"),s=R(s,"toolSuffix"),t&&(n.buttons=t),r&&(n.buttonPrefix=r),a&&(n.buttonSuffix=a),o&&(n.tools=o),l&&(n.toolPrefix=l),s)&&(n.toolSuffix=s),e.push((0,_vue.h)(_toolbar.default,Object.assign(Object.assign({ref:u},i),{slots:void 0}),n))),(0,_vue.h)("div",{ref:p,key:"toolbar",class:"vxe-grid--toolbar-wrapper"},e)}return renderEmptyElement(q)},ve=()=>{var e=c.top;return e?(0,_vue.h)("div",{ref:f,key:"top",class:"vxe-grid--top-wrapper"},e({$grid:q,$gantt:null})):renderEmptyElement(q)},me=()=>{var e=c.left;return e?(0,_vue.h)("div",{class:"vxe-grid--left-wrapper"},e({$grid:q,$gantt:null})):renderEmptyElement(q)},pe=()=>{var e=c.right;return e?(0,_vue.h)("div",{class:"vxe-grid--right-wrapper"},e({$grid:q,$gantt:null})):renderEmptyElement(q)},fe=()=>{var e=d.proxyConfig,t=S.value,r=F.value,a=Object.assign({},_e),o=c.empty,l=c.loading,n=c.rowDragIcon||c["row-drag-icon"],i=c.columnDragIcon||c["column-drag-icon"],s=c.headerTooltip||c["header-tooltip"],u=c.tooltip,g=c.footerTooltip||c["footer-tooltip"],e=(e&&(0,_utils.isEnableConf)(r)&&(r.sort&&(a.onSortChange=ee,a.onClearAllSort=te),r.filter)&&(a.onFilterChange=ae,a.onClearAllFilter=oe),{});return o&&(e.empty=o),l&&(e.loading=l),n&&(e.rowDragIcon=n),i&&(e.columnDragIcon=i),s&&(e.headerTooltip=s),u&&(e.tooltip=u),g&&(e.footerTooltip=g),(0,_vue.h)("div",{class:"vxe-grid--table-wrapper"},[(0,_vue.h)(_table.default,Object.assign(Object.assign({ref:M},t),a),e)])},xe=()=>c.bottom?(0,_vue.h)("div",{ref:x,key:"bottom",class:"vxe-grid--bottom-wrapper"},c.bottom({$grid:q,$gantt:null})):renderEmptyElement(q),be=()=>{var{proxyConfig:e,pagerConfig:t}=d,r=F.value,a=j.value,o=c.pager;return t&&(0,_utils.isEnableConf)(a)||c.pager?(0,_vue.h)("div",{ref:b,key:"pager",class:"vxe-grid--pager-wrapper"},o?o({$grid:q,$gantt:null}):[l?(0,_vue.h)(l,Object.assign(Object.assign(Object.assign({ref:s},a),e&&(0,_utils.isEnableConf)(r)?$.tablePage:{}),{onPageChange:J}),ge(a.slots)):renderEmptyElement(q)]):renderEmptyElement(q)},w=e=>{let t=[];return e.forEach(e=>{switch(e){case"Form":t.push(de());break;case"Toolbar":t.push(ce());break;case"Top":t.push(ve());break;case"Table":t.push((0,_vue.h)("div",{key:"table",class:"vxe-grid--table-container"},[me(),fe(),pe()]));break;case"Bottom":t.push(xe());break;case"Pager":t.push(be());break;default:(0,_log.errLog)("vxe.error.notProp",["[grid] layouts -> "+e])}}),t},_e={},he=(_emits2.tableEmits.forEach(t=>{var e=_xeUtils.default.camelCase("on-"+t);_e[e]=(...e)=>a(t,...e)}),()=>{var e=C.value;if(e.items){let n={};return e.items.forEach(t=>{var r,a,{field:o,itemRender:l}=t;if(o){let e=null;l&&({startField:l,endField:r,defaultValue:a}=l,_xeUtils.default.isFunction(a)?e=a({item:t}):_xeUtils.default.isUndefined(a)||(e=a),l)&&r&&(_xeUtils.default.set(n,l,null),_xeUtils.default.set(n,r,null)),n[o]=e}}),n}return{}}),Ce=()=>{var{proxyConfig:e,formConfig:t}=d,r=$.proxyInited,a=F.value,o=C.value;e&&(0,_utils.isEnableConf)(a)&&(t&&(0,_utils.isEnableConf)(o)&&a.form&&o.items&&($.formData=he()),r||!($.proxyInited=!0)!==a.autoLoad&&(0,_vue.nextTick)().then(()=>q.commitProxy("initial")).then(e=>{Ee("proxy-query",Object.assign(Object.assign({},e),{isInited:!0}),new Event("initial"))}))},ye=e=>{var t=y.value;globalEvents.hasKey(e,GLOBAL_EVENT_KEYS.ESCAPE)&&$.isZMax&&!1!==t.escRestore&&q.triggerZoomEvent(e)},Ee=(e,t,r)=>{a(e,createEvent(r,{$grid:q,$gantt:null},t))};r={dispatchEvent:Ee,getEl(){return g.value},commitProxy(t,...v){let{proxyConfig:i,toolbarConfig:e,pagerConfig:s,editRules:m,validConfig:p}=d,u=$.tablePage,f=D.value,x=z.value;var b=F.value;let _=j.value;var r=B.value;let{beforeQuery:h,afterQuery:C,beforeDelete:n,afterDelete:y,beforeSave:E,afterSave:R,ajax:w={}}=b,P=b.response||b.props||{},k=M.value;if(k){let g=L(),d=null,c=null;c=_xeUtils.default.isString(t)?(a=r.buttons,r=e&&(0,_utils.isEnableConf)(r)&&a?_xeUtils.default.findTree(a,e=>e.code===t,{children:"dropdowns"}):null,d=r?r.item:null,t):(d=t).code;var a,o=d?d.params:null;switch(c){case"insert":return k.insert({});case"insert_edit":return k.insert({}).then(({row:e})=>k.setEditRow(e,!0));case"insert_actived":return k.insert({}).then(({row:e})=>k.setEditRow(e,!0));case"mark_cancel":S=c,U=D.value,I=M.value,(T=I?I.getCheckboxRecords():[]).length?(I&&I.togglePendingRow(T),q.clearCheckboxRow()):U&&_ui.VxeUI.modal&&_ui.VxeUI.modal.message({id:S,content:getI18n("vxe.grid.selectOneRecord"),status:"warning"});break;case"remove":return Y(c,"vxe.grid.removeSelectRecord",()=>k.removeCheckboxRow());case"import":k.importData(o);break;case"open_import":k.openImport(o);break;case"export":k.exportData(o);break;case"open_export":k.openExport(o);break;case"reset_custom":return k.resetCustom(!0);case"initial":case"reload":case"query":{var I=w.query;let n=w.querySuccess,a=w.queryError;if(I){var T="initial"===c,U="reload"===c;if(!T&&$.tableLoading)return(0,_vue.nextTick)();let e=null,r=[],o=[],t={};if(s&&((T||U)&&(u.currentPage=1),(0,_utils.isEnableConf)(_))&&(t=Object.assign({},u)),T){if(i&&(0,_utils.isEnableConf)(b)&&b.form&&(g=he(),$.formData=g),k){let{tableFullColumn:e,fullColumnFieldData:a}=k.internalData;var S=k.getComputeMaps().computeSortOpts;let t=S.value.defaultSort;e.forEach(e=>{e.order=null}),t&&(_xeUtils.default.isArray(t)||(t=[t]),r=t.map(e=>{var{field:e,order:t}=e,r=a[e];return r&&(r=r.column)&&(r.order=t),{field:e,property:e,order:t}})),o=k.getCheckedFilters()}}else k&&(U?e=k.clearAll():(r=k.getSortColumns(),o=k.getCheckedFilters()));let l={$table:k,$grid:q,$gantt:null,code:c,button:d,isInited:T,isReload:U,page:t,sort:r.length?r[0]:{},sorts:r,filters:o,form:g,options:I};return $.sortData=r,$.filterData=o,$.tableLoading=!0,Promise.all([Promise.resolve((h||I)(l,...v)),e]).then(([e])=>{let t=[];var r,a;return $.tableLoading=!1,e&&(s&&(0,_utils.isEnableConf)(_)?(a=P.total,a=(_xeUtils.default.isFunction(a)?a({data:e,$table:k,$grid:q,$gantt:null}):_xeUtils.default.get(e,a||"page.total"))||0,u.total=_xeUtils.default.toNumber(a),r=P.result,t=(_xeUtils.default.isFunction(r)?r({data:e,$table:k,$grid:q,$gantt:null}):_xeUtils.default.get(e,r||"result"))||[],r=Math.max(Math.ceil(a/u.pageSize),1),u.currentPage>r&&(u.currentPage=r)):(a=P.list,t=(a?_xeUtils.default.isFunction(a)?a({data:e,$table:k,$grid:q,$gantt:null}):_xeUtils.default.get(e,a):e)||[])),k?k.loadData(t):(0,_vue.nextTick)(()=>{var e=M.value;e&&e.loadData(t)}),C&&C(l,...v),n&&n(Object.assign(Object.assign({},l),{response:e})),{status:!0}}).catch(e=>($.tableLoading=!1,a&&a(Object.assign(Object.assign({},l),{response:e})),{status:!1}))}(0,_log.errLog)("vxe.error.notFunc",["[grid] proxy-config.ajax.query"]);break}case"delete":{let a=w.delete,o=w.deleteSuccess,l=w.deleteError;if(a){let e=q.getCheckboxRecords(),t=e.filter(e=>!k.isInsertByRow(e));var O={removeRecords:t};let r={$table:k,$grid:q,$gantt:null,code:c,button:d,body:O,form:g,options:a};if(e.length)return Y(c,"vxe.grid.deleteSelectRecord",()=>t.length?($.tableLoading=!0,Promise.resolve((n||a)(r,...v)).then(e=>($.tableLoading=!1,k.setPendingRow(t,!1),x&&_ui.VxeUI.modal&&_ui.VxeUI.modal.message({content:V(e,"vxe.grid.delSuccess"),status:"success"}),y?y(r,...v):q.commitProxy("query"),o&&o(Object.assign(Object.assign({},r),{response:e})),{status:!0})).catch(e=>($.tableLoading=!1,x&&_ui.VxeUI.modal&&_ui.VxeUI.modal.message({id:c,content:V(e,"vxe.grid.operError"),status:"error"}),l&&l(Object.assign(Object.assign({},r),{response:e})),{status:!1}))):k.remove(e));f&&_ui.VxeUI.modal&&_ui.VxeUI.modal.message({id:c,content:getI18n("vxe.grid.selectOneRecord"),status:"warning"})}else(0,_log.errLog)("vxe.error.notFunc",["[grid] proxy-config.ajax.delete"]);break}case"save":{let i=w.save,s=w.saveSuccess,u=w.saveError;if(i){let t=k.getRecordset(),{insertRecords:r,removeRecords:a,updateRecords:o,pendingRecords:l}=t,n={$table:k,$grid:q,$gantt:null,code:c,button:d,body:t,form:g,options:i},e=(r.length&&(t.pendingRecords=l.filter(e=>-1===k.findRowIndexOf(r,e))),l.length&&(t.insertRecords=r.filter(e=>-1===k.findRowIndexOf(l,e))),Promise.resolve());return(e=m?k[p&&"full"===p.msgMode?"fullValidate":"validate"](t.insertRecords.concat(o)):e).then(e=>{if(!e)return t.insertRecords.length||a.length||o.length||t.pendingRecords.length?($.tableLoading=!0,Promise.resolve((E||i)(n,...v)).then(e=>($.tableLoading=!1,k.clearPendingRow(),x&&_ui.VxeUI.modal&&_ui.VxeUI.modal.message({content:V(e,"vxe.grid.saveSuccess"),status:"success"}),R?R(n,...v):q.commitProxy("query"),s&&s(Object.assign(Object.assign({},n),{response:e})),{status:!0})).catch(e=>($.tableLoading=!1,x&&_ui.VxeUI.modal&&_ui.VxeUI.modal.message({id:c,content:V(e,"vxe.grid.operError"),status:"error"}),u&&u(Object.assign(Object.assign({},n),{response:e})),{status:!1}))):void(f&&_ui.VxeUI.modal&&_ui.VxeUI.modal.message({id:c,content:getI18n("vxe.grid.dataUnchanged"),status:"info"}))})}(0,_log.errLog)("vxe.error.notFunc",["[grid] proxy-config.ajax.save"]);break}default:var O=commands.get(c);O&&((O=O.tableCommandMethod||O.commandMethod)?O({code:c,button:d,$grid:q,$table:k,$gantt:null},...v):(0,_log.errLog)("vxe.error.notCommands",["[grid] "+c]))}}return(0,_vue.nextTick)()},getParams(){return d.params},zoom(){return $.isZMax?q.revert():q.maximize()},isMaximized(){return $.isZMax},maximize(){return ue(!0)},revert(){return ue()},getFormData:L,getFormItems(e){var t=C.value,r=d.formConfig,a=t.items;let o=[];return _xeUtils.default.eachTree(r&&(0,_utils.isEnableConf)(t)&&a?a:[],e=>{o.push(e)},{children:"children"}),_xeUtils.default.isUndefined(e)?o:o[e]},resetForm(){var e=i.value;return e?e.reset():(0,_vue.nextTick)()},validateForm(){var e=i.value;return e?e.validate():(0,_vue.nextTick)()},validateFormField(e){var t=i.value;return t?t.validateField(e):(0,_vue.nextTick)()},clearFormValidate(e){var t=i.value;return t?t.clearValidate(e):(0,_vue.nextTick)()},homePage(){var e=$.tablePage;return e.currentPage=1,(0,_vue.nextTick)()},homePageByEvent(e){var t=s.value;t&&t.homePageByEvent(e)},endPage(){var e=$.tablePage,t=K.value;return e.currentPage=t,(0,_vue.nextTick)()},endPageByEvent(e){var t=s.value;t&&t.endPageByEvent(e)},getCurrentPage(){var e=$.tablePage;return e.currentPage},setCurrentPage(e){var t=$.tablePage,r=K.value;return t.currentPage=Math.min(r,Math.max(1,_xeUtils.default.toNumber(e))),(0,_vue.nextTick)()},setCurrentPageByEvent(e,t){var r=s.value;r&&r.setCurrentPageByEvent(e,t)},getPageSize(){var e=$.tablePage;return e.pageSize},setPageSize(e){var t=$.tablePage;return t.pageSize=Math.max(1,_xeUtils.default.toNumber(e)),(0,_vue.nextTick)()},setPageSizeByEvent(e,t){var r=s.value;r&&r.setPageSizeByEvent(e,t)},getProxyInfo(){var e,t=M.value;return d.proxyConfig?(e=$.sortData,{data:t?t.getFullData():[],filter:$.filterData,form:L(),sort:e.length?e[0]:{},sorts:e,pager:$.tablePage,pendingRecords:t?t.getPendingRecords():[]}):null}};let Re={extendTableMethods:_,callSlot(e,t){return e&&(_xeUtils.default.isString(e)&&(e=c[e]||null),_xeUtils.default.isFunction(e))?(0,_vn.getSlotVNs)(e(t)):[]},getExcludeHeight(){var t=d.height,r=$.isZMax,a=g.value;if(a){var o=m.value,l=p.value,n=f.value,i=x.value,s=b.value,u=a.parentElement;let e=0;return(e=!u||"100%"!==t&&"auto"!==t?e:r?0:(0,_dom.getPaddingTopBottomSize)(u))+(0,_dom.getPaddingTopBottomSize)(a)+(0,_dom.getOffsetHeight)(o)+(0,_dom.getOffsetHeight)(l)+(0,_dom.getOffsetHeight)(n)+(0,_dom.getOffsetHeight)(i)+(0,_dom.getOffsetHeight)(s)}return 0},getParentHeight(){var e=g.value;return e?(e=e.parentElement,($.isZMax?(0,_dom.getDomNode)().visibleHeight:e?_xeUtils.default.toNumber(getComputedStyle(e).height):0)-Re.getExcludeHeight()):0},triggerToolbarCommitEvent(e,t){let r=e.code;return q.commitProxy(e,t).then(e=>{r&&e&&e.status&&["query","reload","delete","save"].includes(r)&&q.dispatchEvent("delete"===r||"save"===r?"proxy-"+r:"proxy-query",Object.assign(Object.assign({},e),{isReload:"reload"===r}),t)})},triggerToolbarBtnEvent(e,t){q.triggerToolbarCommitEvent(e,t),q.dispatchEvent("toolbar-button-click",{code:e.code,button:e},t)},triggerToolbarTolEvent(e,t){q.triggerToolbarCommitEvent(e,t),q.dispatchEvent("toolbar-tool-click",{code:e.code,tool:e},t)},triggerZoomEvent(e){q.zoom(),q.dispatchEvent("zoom",{type:$.isZMax?"max":"revert"},e)}};Object.assign(q,h,r,Re,{loadColumn(e){var t=M.value;return _xeUtils.default.eachTree(e,e=>{e.slots&&_xeUtils.default.each(e.slots,e=>{_xeUtils.default.isFunction(e)||c[e]||(0,_log.errLog)("vxe.error.notSlot",["[grid] "+e])})}),t?t.loadColumn(e):(0,_vue.nextTick)()},reloadColumn(e){return q.clearAll(),q.loadColumn(e)}});let P=(0,_vue.ref)(0);return(0,_vue.watch)(()=>d.columns?d.columns.length:-1,()=>{P.value++}),(0,_vue.watch)(()=>d.columns,()=>{P.value++}),(0,_vue.watch)(P,()=>{(0,_vue.nextTick)(()=>q.loadColumn(d.columns||[]))}),(0,_vue.watch)(()=>d.toolbarConfig,()=>{W()}),(0,_vue.watch)(A,()=>{E("currentPage")}),(0,_vue.watch)(H,()=>{E("pageSize")}),(0,_vue.watch)(Z,()=>{E("total")}),(0,_vue.watch)(()=>d.proxyConfig,()=>{Ce()}),hooks.forEach(e=>{var e=e.setupGrid;e&&(e=e(q))&&_xeUtils.default.isObject(e)&&Object.assign(q,e)}),E(),(0,_vue.onMounted)(()=>{(0,_vue.nextTick)(()=>{var e=d.columns,t=F.value;d.formConfig&&!n&&(0,_log.errLog)("vxe.error.reqComp",["vxe-form"]),d.pagerConfig&&!l&&(0,_log.errLog)("vxe.error.reqComp",["vxe-pager"]),t.props&&(0,_log.warnLog)("vxe.error.delProp",["[grid] proxy-config.props","proxy-config.response"]),e&&e.length&&q.loadColumn(e),W(),Ce()}),globalEvents.on(q,"keydown",ye)}),(0,_vue.onUnmounted)(()=>{globalEvents.off(q,"keydown"),_xeUtils.default.assign(o,createInternalData())}),q.renderVN=()=>{var e=I.value,t=T.value,r=G.value;return(0,_vue.h)("div",{ref:g,class:["vxe-grid",{["size--"+e]:e,"is--animat":!!d.animat,"is--round":d.round,"is--maximize":$.isZMax,"is--loading":r}],style:t},(()=>{var{headKeys:e,bodyKeys:t,footKeys:r}=O.value,a=c.asideLeft||c["aside-left"],o=c.asideRight||c["aside-right"];return[(0,_vue.h)("div",{class:"vxe-grid--layout-header-wrapper"},w(e)),(0,_vue.h)("div",{class:"vxe-grid--layout-body-wrapper"},[a?(0,_vue.h)("div",{class:"vxe-grid--layout-aside-left-wrapper"},a({})):renderEmptyElement(q),(0,_vue.h)("div",{class:"vxe-grid--layout-body-content-wrapper"},w(t)),o?(0,_vue.h)("div",{class:"vxe-grid--layout-aside-right-wrapper"},o({})):renderEmptyElement(q)]),(0,_vue.h)("div",{class:"vxe-grid--layout-footer-wrapper"},w(r)),(0,_vue.h)("div",{ref:v})]})())},(0,_vue.provide)("$xeGrid",q),(0,_vue.provide)("$xeGantt",null),q},render(){return this.renderVN()}});