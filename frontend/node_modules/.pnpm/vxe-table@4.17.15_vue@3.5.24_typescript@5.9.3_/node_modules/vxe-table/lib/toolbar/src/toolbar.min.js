Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_vn=require("../../ui/src/vn"),_log=require("../../ui/src/log");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let{getConfig,getIcon,getI18n,renderer,commands,createEvent,useFns}=_ui.VxeUI;function createInternalData(){return{connectTable:null}}var _default=exports.default=(0,_comp.defineVxeComponent)({name:"VxeToolbar",props:{loading:Boolean,refresh:[Boolean,Object],refreshOptions:Object,import:[Boolean,Object],importOptions:Object,export:[Boolean,Object],exportOptions:Object,print:[Boolean,Object],printOptions:Object,zoom:[Boolean,Object],zoomOptions:Object,custom:[Boolean,Object],customOptions:Object,buttons:{type:Array,default:()=>getConfig().toolbar.buttons},tools:{type:Array,default:()=>getConfig().toolbar.tools},perfect:{type:Boolean,default:()=>getConfig().toolbar.perfect},size:{type:String,default:()=>getConfig().toolbar.size||getConfig().size},className:[String,Function]},emits:["button-click","tool-click"],setup(u,e){let{slots:g,emit:r}=e;var t=_xeUtils.default.uniqueId();let b=_ui.VxeUI.getComponent("VxeButton"),p=(0,_vue.inject)("$xeGrid",null),v=(0,_vue.inject)("$xeGantt",null),m=p||v,d=useFns.useSize(u).computeSize,_=(0,_vue.reactive)({isRefresh:!1,connectFlag:0,columns:[]}),f=createInternalData(),x=(0,_vue.ref)(),o={refElem:x},O={xID:t,props:u,context:e,reactData:_,internalData:f,getRefMaps:()=>o};let h=(0,_vue.computed)(()=>Object.assign({},_xeUtils.default.clone(getConfig().toolbar.refresh,!0),u.refreshOptions,u.refresh)),T=(0,_vue.computed)(()=>Object.assign({},_xeUtils.default.clone(getConfig().toolbar.import,!0),u.importOptions,u.import)),C=(0,_vue.computed)(()=>Object.assign({},_xeUtils.default.clone(getConfig().toolbar.export,!0),u.exportOptions,u.export)),$=(0,_vue.computed)(()=>Object.assign({},_xeUtils.default.clone(getConfig().toolbar.print,!0),u.printOptions,u.print)),j=(0,_vue.computed)(()=>Object.assign({},_xeUtils.default.clone(getConfig().toolbar.zoom,!0),u.zoomOptions,u.zoom)),L=(0,_vue.computed)(()=>Object.assign({},_xeUtils.default.clone(getConfig().toolbar.custom,!0),u.customOptions,u.custom)),n=(0,_vue.computed)(()=>{var e=f.connectTable;if((_.connectFlag||e)&&e)return e=e.getComputeMaps().computeCustomOpts,e.value;return{trigger:""}}),k=(0,_vue.computed)(()=>n.value.trigger),a=()=>{var e=f.connectTable;if(e)return!0;(0,_log.errLog)("vxe.error.barUnableLink")},I=({$event:e})=>{var t=f.connectTable;t&&t.triggerCustomEvent&&t.triggerCustomEvent(e)},R=({$event:e})=>{var t=f.connectTable;t&&t.customOpenEvent(e)},y=({$event:t})=>{var e=f.connectTable;let o=e;if(o){let e=o.reactData.customStore;e.activeBtn=!1,setTimeout(()=>{e.activeBtn||e.activeWrapper||o.customCloseEvent(t)},350)}},E=({$event:e})=>{var t=_.isRefresh,o=h.value;if(!t){t=o.queryMethod||o.query;if(t){_.isRefresh=!0;try{Promise.resolve(t({})).catch(e=>e).then(()=>{_.isRefresh=!1})}catch(e){_.isRefresh=!1}}else m&&(_.isRefresh=!0,m.triggerToolbarCommitEvent({code:o.code||"reload"},e).catch(()=>{}).then(()=>{_.isRefresh=!1}))}},P=({$event:e})=>{m?m.triggerZoomEvent(e):(0,_log.warnLog)("vxe.error.notProp",["[toolbar] zoom"])},i=()=>{var e;a()&&(e=f.connectTable,e)&&e.importData()},S=()=>{var e;a()&&(e=f.connectTable,e)&&e.openImport()},s=()=>{var e;a()&&(e=f.connectTable,e)&&e.exportData()},U=()=>{var e;a()&&(e=f.connectTable,e)&&e.openExport()},c=()=>{var e;a()&&(e=f.connectTable,e)&&e.print()},w=()=>{var e;a()&&(e=f.connectTable,e)&&e.openPrint()},l=(e,t,o)=>{switch(t.code){case"print":c();break;case"open_print":w();break;case"custom":I(e);break;case"export":s();break;case"open_export":U();break;case"import":i();break;case"open_import":S();break;case"zoom":P(e);break;case"refresh":E(e);break;default:o()}},N=(e,o)=>{let r=e.$event;var t=f.connectTable;let n=t,a=o.code;a&&l(e,o,()=>{var e,t;m?m.triggerToolbarBtnEvent(o,r):(t=commands.get(a),e={code:a,button:o,$table:n,$grid:p,$gantt:v,$event:r},t&&((t=t.tableCommandMethod||t.commandMethod)?t(e):(0,_log.errLog)("vxe.error.notCommands",["[toolbar] "+a])),O.dispatchEvent("button-click",e,r))})},B=(e,o)=>{let r=e.$event;var t=f.connectTable;let n=t,a=o.code;a&&l(e,o,()=>{var e,t;m?m.triggerToolbarTolEvent(o,r):(t=commands.get(a),e={code:a,button:null,tool:o,$table:n,$grid:p,$gantt:v,$event:r},t&&((t=t.tableCommandMethod||t.commandMethod)?t(e):(0,_log.errLog)("vxe.error.notCommands",["[toolbar] "+a])),O.dispatchEvent("tool-click",e,r))})};Object.assign(O,{dispatchEvent:(e,t,o)=>{r(e,createEvent(o,{$toolbar:O},t))},syncUpdate(e){f.connectTable=e.$table,_.columns=e.collectColumn,_.connectFlag++}});let z=(e,o)=>{e=e.dropdowns;return e?e.map((t,e)=>!1!==t.visible&&b?(0,_vue.h)(b,Object.assign(Object.assign({key:e},Object.assign({},t,{content:t.content||t.name,options:void 0})),{onClick:e=>(o?N:B)(e,t)})):(0,_vue.createCommentVNode)()):[]};return O.renderVN=()=>{var{perfect:e,loading:t,refresh:o,zoom:r,custom:n,className:a}=u,l=f.connectTable,i=d.value,s=g.tools,c=g.buttons;return(0,_vue.h)("div",{ref:x,class:["vxe-toolbar",a?_xeUtils.default.isFunction(a)?a({$toolbar:O}):a:"",{["size--"+i]:i,"is--perfect":e,"is--loading":t}]},[(0,_vue.h)("div",{class:"vxe-buttons--wrapper"},c?c({$grid:p,$gantt:v,$table:l}):(()=>{var e=u.buttons,t=f.connectTable;let i=t;var t=g.buttonPrefix||g["button-prefix"],o=g.buttonSuffix||g["button-suffix"];let s=[];return t&&s.push(...(0,_vn.getSlotVNs)(t({buttons:e||[],$grid:p,$gantt:v,$table:i}))),e&&e.forEach((t,e)=>{var o,r,n,{dropdowns:a,buttonRender:l}=t;!1!==t.visible&&(o=l?renderer.get(l.name):null,l&&o&&o.renderToolbarButton?(r=o.toolbarButtonClassName,n={$grid:p,$gantt:v,$table:i,button:t},s.push((0,_vue.h)("span",{key:"br"+(t.code||e),class:["vxe-button--item",r?_xeUtils.default.isFunction(r)?r(n):r:""]},(0,_vn.getSlotVNs)(o.renderToolbarButton(l,n))))):b&&s.push((0,_vue.h)(b,Object.assign(Object.assign({key:"bd"+(t.code||e)},Object.assign({},t,{content:t.content||t.name,options:void 0})),{onClick:e=>N(e,t)}),a&&a.length?{dropdowns:()=>z(t,!0)}:{})))}),o&&s.push(...(0,_vn.getSlotVNs)(o({buttons:e||[],$grid:p,$gantt:v,$table:i}))),s})()),(0,_vue.h)("div",{class:"vxe-tools--wrapper"},s?s({$grid:p,$gantt:v,$table:l}):(()=>{var e=u.tools,t=f.connectTable;let s=t;var t=g.toolPrefix||g["tool-prefix"],o=g.toolSuffix||g["tool-suffix"];let c=[];return t&&c.push(...(0,_vn.getSlotVNs)(t({tools:e||[],$grid:p,$gantt:v,$table:s}))),e&&e.forEach((t,e)=>{var o,r,n,a,{dropdowns:l,toolRender:i}=t;!1!==t.visible&&(o=i?i.name:null,r=i?renderer.get(o):null,i&&r&&r.renderToolbarTool?(n=r.toolbarToolClassName,a={$grid:p,$gantt:v,$table:s,tool:t},c.push((0,_vue.h)("span",{key:o,class:["vxe-tool--item",n?_xeUtils.default.isFunction(n)?n(a):n:""]},(0,_vn.getSlotVNs)(r.renderToolbarTool(i,a))))):b&&c.push((0,_vue.h)(b,Object.assign(Object.assign({key:e},Object.assign({},t,{content:t.content||t.name,options:void 0})),{onClick:e=>B(e,t)}),l&&l.length?{dropdowns:()=>z(t,!1)}:{})))}),o&&c.push(...(0,_vn.getSlotVNs)(o({tools:e||[],$grid:p,$gantt:v,$table:s}))),c})()),(0,_vue.h)("div",{class:"vxe-tools--operate"},[u.import&&(a=T.value,b)?(0,_vue.h)(b,{key:"import",circle:!0,icon:a.icon||getIcon().TOOLBAR_TOOLS_IMPORT,title:getI18n("vxe.toolbar.import"),onClick:S}):(0,_vue.createCommentVNode)(),u.export&&(i=C.value,b)?(0,_vue.h)(b,{key:"export",circle:!0,icon:i.icon||getIcon().TOOLBAR_TOOLS_EXPORT,title:getI18n("vxe.toolbar.export"),onClick:U}):(0,_vue.createCommentVNode)(),u.print&&(e=$.value,b)?(0,_vue.h)(b,{key:"print",circle:!0,icon:e.icon||getIcon().TOOLBAR_TOOLS_PRINT,title:getI18n("vxe.toolbar.print"),onClick:w}):(0,_vue.createCommentVNode)(),o&&(t=h.value,b)?(0,_vue.h)(b,{key:"refresh",circle:!0,icon:_.isRefresh?t.iconLoading||getIcon().TOOLBAR_TOOLS_REFRESH_LOADING:t.icon||getIcon().TOOLBAR_TOOLS_REFRESH,title:getI18n("vxe.toolbar.refresh"),onClick:E}):(0,_vue.createCommentVNode)(),r&&m&&(c=j.value,m)&&b?(0,_vue.h)(b,{key:"zoom",circle:!0,icon:m.isMaximized()?c.iconOut||getIcon().TOOLBAR_TOOLS_MINIMIZE:c.iconIn||getIcon().TOOLBAR_TOOLS_FULLSCREEN,title:getI18n("vxe.toolbar.zoom"+(m.isMaximized()?"Out":"In")),onClick:P}):(0,_vue.createCommentVNode)(),n&&(s=L.value,l=k.value,a={},"manual"!==l&&("hover"===l?(a.onMouseenter=R,a.onMouseleave=y):a.onClick=I),b)?(0,_vue.h)(b,Object.assign({key:"custom",circle:!0,icon:s.icon||getIcon().TOOLBAR_TOOLS_CUSTOM,title:getI18n("vxe.toolbar.custom"),className:"vxe-toolbar-custom-target"},a)):(0,_vue.createCommentVNode)()])])},(0,_vue.nextTick)(()=>{var e=h.value,e=e.queryMethod||e.query,e=(!u.refresh||m||e||(0,_log.warnLog)("vxe.error.notFunc",["[toolbar] queryMethod"]),_xeUtils.default.isPlainObject(u.custom)&&(0,_log.warnLog)("vxe.error.delProp",["[toolbar] custom={...}","custom=boolean & custom-options={...}"]),_xeUtils.default.isPlainObject(u.print)&&(0,_log.warnLog)("vxe.error.delProp",["[toolbar] print={...}","print=boolean & print-options={...}"]),_xeUtils.default.isPlainObject(u.export)&&(0,_log.warnLog)("vxe.error.delProp",["[toolbar] export={...}","export=boolean & export-options={...}"]),_xeUtils.default.isPlainObject(u.import)&&(0,_log.warnLog)("vxe.error.delProp",["[toolbar] import={...}","import=boolean & import-options={...}"]),_xeUtils.default.isPlainObject(u.refresh)&&(0,_log.warnLog)("vxe.error.delProp",["[toolbar] refresh={...}","refresh=boolean & refresh-options={...}"]),_xeUtils.default.isPlainObject(u.refresh)&&(0,_log.warnLog)("vxe.error.delProp",["[toolbar] zoom={...}","zoom=boolean & zoom-options={...}"]),L.value);e.isFooter&&(0,_log.warnLog)("vxe.error.delProp",["[toolbar] toolbar.custom.isFooter","table.custom-config.showFooter"]),e.showFooter&&(0,_log.warnLog)("vxe.error.delProp",["[toolbar] toolbar.custom.showFooter","table.custom-config.showFooter"]),e.immediate&&(0,_log.warnLog)("vxe.error.delProp",["[toolbar] toolbar.custom.immediate","table.custom-config.immediate"]),e.trigger&&(0,_log.warnLog)("vxe.error.delProp",["[toolbar] toolbar.custom.trigger","table.custom-config.trigger"]),(u.refresh||u.import||u.export||u.print||u.zoom)&&!b&&(0,_log.errLog)("vxe.error.reqComp",["vxe-button"])}),(0,_vue.onUnmounted)(()=>{_xeUtils.default.assign(f,createInternalData())}),O},render(){return this.renderVN()}});