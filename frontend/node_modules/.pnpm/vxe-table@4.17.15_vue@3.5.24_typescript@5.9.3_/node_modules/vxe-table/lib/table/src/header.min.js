Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_utils=require("../../ui/src/utils"),_util=require("./util"),_vn=require("../../ui/src/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let{renderer,renderEmptyElement}=_ui.VxeUI,sourceType="table",renderType="header";function getColumnFirstChild(e){var l=e.children;return l&&l.length?getColumnFirstChild(l[0]):e}function getColumnLastChild(e){var l=e.children;return l&&l.length?getColumnLastChild(l[l.length-1]):e}var _default=exports.default=(0,_comp.defineVxeComponent)({name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,tableGroupColumn:Array,fixedColumn:Array,fixedType:{type:String,default:null}},setup(g){let pe=(0,_vue.inject)("$xeTable",{}),{xID:x,props:m,reactData:f,internalData:_}=pe,{computeColumnOpts:r,computeColumnDragOpts:a,computeCellOpts:t,computeMouseOpts:C,computeHeaderCellOpts:i,computeDefaultRowHeight:n,computeVirtualXOpts:d,computeFloatingFilterOpts:b,computeIsHeaderRenderOptimize:w}=pe.getComputeMaps(),y=(0,_vue.ref)([]),H=(0,_vue.ref)(),D=(0,_vue.ref)(),E=(0,_vue.ref)(),T=(0,_vue.ref)(),S=(0,_vue.ref)(),F=(0,_vue.ref)(),o=(0,_vue.ref)(),u=()=>{var e=m.showCustomHeader,{collectColumn:l,visibleColumn:r}=_,a=g.tableGroupColumn,t=f.isGroup;let i=t?(0,_util.convertHeaderColumnToRows)(a):[],n=[];e&&1<i.length&&(n=(0,_util.convertHeaderToGridRows)(i),i=n),y.value=i,pe.dispatchEvent("columns-change",{visibleColgroups:n,collectColumn:l,visibleColumn:r},null)},O=(F,O,e,I,R)=>{let $=pe.xeGrid,k=pe.xeGantt,M=g.fixedType,{resizable:U,columnKey:z,showCustomHeader:A,headerCellClassName:q,headerCellStyle:L,showHeaderOverflow:G,headerAlign:X,align:j,mouseConfig:N}=m,{currentColumn:W,dragCol:V,scrollXLoad:B,scrollYLoad:K,overflowX:P,mergeHeadFlag:Y,tableColumn:J}=f,{fullColumnIdData:Q,scrollXStore:Z,mergeHeaderList:ee,mergeHeaderCellMaps:le}=_,re=d.value,ae=r.value,te=a.value,ie=t.value;var l=n.value;let ne=i.value,de=(0,_util.getCalcHeight)(ne.height)||l,{disabledMethod:oe,isCrossDrag:se,isPeerDrag:ce}=te,ue=I===e.length-1;return R.map((e,l)=>{var{type:r,showHeaderOverflow:a,headerAlign:t,align:i,filters:n,headerClassName:d,editRender:o,cellRender:u}=e,s=e.id,c=Q[s]||{},o=o||u,u=o?renderer.get(o.name):null,o=e.children&&e.children.length,p=P&&!o&&(M?e.fixed!==M:!!e.fixed),v=(_xeUtils.default.isBoolean(ne.padding)?ne:ie).padding,a=_xeUtils.default.eqNull(a)?G:a,t=t||(u?u.tableHeaderCellAlign:"")||X||i||(u?u.tableCellAlign:"")||j,i="ellipsis"===a,u="title"===a,a=!0===a||"tooltip"===a,h=u||a||i;let g=!1,x=null;n&&(x=n[0],g=n.some(e=>e.checked));var m=c.index,c=c._index;let f={$table:pe,$grid:$,$gantt:k,$rowIndex:I,column:e,columnIndex:m,$columnIndex:l,_columnIndex:c,firstFilterOption:x,fixed:M,source:sourceType,type:renderType,isHidden:p,hasFilter:g};m={colid:s};let _=!1;if(A||(m.colspan=1<e.colSpan?e.colSpan:null,m.rowspan=1<e.rowSpan?e.rowSpan:null),Y&&ee.length&&(A||ue)){var C=le[I+":"+(A?l:c)];if(C){var{rowspan:C,colspan:b}=C;if(!C||!b)return null;1<C&&(_=!0,m.rowspan=C),1<b&&(_=!0,m.colspan=b)}}C={onClick:e=>pe.triggerHeaderCellClickEvent(e,f),onDblclick:e=>pe.triggerHeaderCellDblclickEvent(e,f)},b=ae.drag&&"cell"===te.trigger;let w=!1;b&&(w=!(!oe||!oe(f))),(N||b)&&(C.onMousedown=e=>pe.triggerHeaderCellMousedownEvent(e,f)),ae.drag&&(C.onDragstart=pe.handleHeaderCellDragDragstartEvent,C.onDragend=pe.handleHeaderCellDragDragendEvent,C.onDragover=pe.handleHeaderCellDragDragoverEvent,b)&&(C.onMouseup=pe.handleHeaderCellDragMouseupEvent);var b=l===R.length-1,y=_xeUtils.default.isBoolean(e.resizable)?e.resizable:ae.resizable||U,H=!e.resizeWidth&&("auto"===e.minWidth||"auto"===e.width);let D=!1;!O||!P||F||_||V&&V.id===s||B&&10<J.length&&!e.fixed&&!re.immediate&&(c<Z.visibleStartIndex-Z.preloadSize||c>Z.visibleEndIndex+Z.preloadSize)&&(D=!0);var E,T,S,c={};return h?c.height=de+"px":c.minHeight=de+"px",A||o&&!ue&&(T=getColumnFirstChild(e),E=getColumnLastChild(e),T)&&E&&T.id!==E.id&&(T=Q[T.id],S=Q[E.id],T)&&S&&(c.width=S.oLeft-T.oLeft+E.renderWidth+"px"),(0,_vue.h)("th",Object.assign(Object.assign(Object.assign({class:["vxe-table--column vxe-header--column",s,p?"fixed--hidden":"fixed--visible",{["col--"+t]:t,["col--"+r]:r,"col--last":b,"col--fixed":e.fixed,"col--group":o,"col--ellipsis":h,"fixed--width":!H,"is--padding":v,"is--sortable":e.sortable,"col--filter":!!n,"is--filter-active":g,"is--drag-active":ae.drag&&!e.fixed&&!w&&(se||ce||!e.parentId),"is--drag-disabled":ae.drag&&w,"col--current":W===e},d?_xeUtils.default.isFunction(d)?d(f):d:"",q?_xeUtils.default.isFunction(q)?q(f):q:""],style:L?_xeUtils.default.isFunction(L)?L(f):L:null},m),C),{key:A?""+s+l:z||B||K||ae.useKey||ae.drag||o?s:l}),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":u,"c--tooltip":a,"c--ellipsis":i}],style:c},D||O&&p?[]:[(0,_vue.h)("div",{colid:s,class:"vxe-cell--wrapper vxe-header-cell--wrapper"},e.renderHeader(f))]),p||!y||A&&!ue?renderEmptyElement(pe):(0,_vue.h)("div",{class:"vxe-cell--col-resizable",onMousedown:e=>pe.handleColResizeMousedownEvent(e,M,f),onDblclick:e=>pe.handleColResizeDblclickEvent(e,f)})])})},I=(b,w)=>{let y=pe.xeGrid,H=pe.xeGantt,D=g.fixedType,{showHeaderOverflow:E,headerAlign:T,align:S}=m,{currentColumn:F,overflowX:O}=f,I=_.fullColumnIdData,R=t.value;var e=n.value;let $=i.value,k=(0,_util.getCalcHeight)($.height)||e;return w.map((e,l)=>{var{type:r,showHeaderOverflow:a,headerAlign:t,align:i,filters:n,editRender:d,cellRender:o,floatingFilters:u,filterRender:s,slots:c}=e,p=e.id,v=I[p]||{},d=d||o,o=c?c.floatingFilter||c["floating-filter"]:null,c=d?renderer.get(d.name):null,d=(0,_utils.isEnableConf)(s)?renderer.get(s.name):null,d=d?d.renderTableFloatingFilter:null,h=O&&(D?e.fixed!==D:!!e.fixed),g=(_xeUtils.default.isBoolean($.padding)?$:R).padding,a=_xeUtils.default.eqNull(a)?E:a,t=t||(c?c.tableHeaderCellAlign:"")||T||i||(c?c.tableCellAlign:"")||S,i="ellipsis"===a,c="title"===a,a=!0===a||"tooltip"===a,x=c||a||i;let m=!1,f=null;n&&(f=n[0],m=n.some(e=>e.checked));var n=v.index,v=v._index,n={$table:pe,$grid:y,$gantt:H,column:e,columnIndex:n,$columnIndex:l,_columnIndex:v,option:f,fixed:D,source:sourceType,type:renderType,isHidden:h,hasFilter:m},v={colid:p},l=l===w.length-1,_=!e.resizeWidth&&("auto"===e.minWidth||"auto"===e.width),C={};return x?C.height=k+"px":C.minHeight=k+"px",(0,_vue.h)("th",Object.assign({class:["vxe-table--column vxe-header--column",p,h?"fixed--hidden":"fixed--visible",{["col--"+t]:t,["col--"+r]:r,"col--last":l,"col--fixed":e.fixed,"col--ellipsis":x,"fixed--width":!_,"is--padding":g,"is--sortable":e.sortable,"col--current":F===e}],key:p},v),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":c,"c--tooltip":a,"c--ellipsis":i}],style:C},b&&h&&!u?[]:[(0,_vue.h)("div",{colid:p,class:"vxe-cell--wrapper vxe-header-cell--wrapper"},o?pe.callSlot(o,n):d&&f?(0,_vn.getSlotVNs)(d(s,n)):[])])])})};return(0,_vue.watch)(()=>g.tableColumn,u),(0,_vue.onMounted)(()=>{(0,_vue.nextTick)(()=>{var e=g.fixedType,l=pe.internalData,l=l.elemStore,e=`${e||"main"}-header-`;l[e+"wrapper"]=H,l[e+"scroll"]=D,l[e+"table"]=E,l[e+"colgroup"]=T,l[e+"list"]=S,l[e+"xSpace"]=F,l[e+"repair"]=o,u()})}),(0,_vue.onUnmounted)(()=>{var e=g.fixedType,l=pe.internalData,l=l.elemStore,e=`${e||"main"}-header-`;l[e+"wrapper"]=null,l[e+"scroll"]=null,l[e+"table"]=null,l[e+"colgroup"]=null,l[e+"list"]=null,l[e+"xSpace"]=null,l[e+"repair"]=null}),()=>{let{fixedType:l,fixedColumn:e,tableColumn:r}=g;var a=m.mouseConfig,{isGroup:t,isColLoading:i,overflowX:n,scrollXLoad:d,dragCol:o}=f,{visibleColumn:u,fullColumnIdData:s}=_,c=C.value,p=w.value;let v=y.value||[],h=r;return t?h=u:(p&&(i||!l&&n)||(h=u),l&&p&&(h=e||[]),v=[h]),l||t||d&&o&&2<h.length&&(i=s[o.id])&&(n=i._index,u=h[0],d=h[h.length-1],i=s[u.id],u=s[d.id],i)&&u&&(s=i._index,d=u._index,n<s?(h=[o].concat(h),v=[[o].concat(v[0])].concat(v.slice(1))):d<n&&(h=h.concat([o]),v=[v[0].concat([o])].concat(v.slice(1)))),(0,_vue.h)("div",{ref:H,class:["vxe-table--header-wrapper",l?`fixed-${l}--wrapper`:"body--wrapper"],xid:x},[(0,_vue.h)("div",{ref:D,class:"vxe-table--header-inner-wrapper",onScroll(e){pe.triggerHeaderScrollEvent(e,l)}},[l?renderEmptyElement(pe):(0,_vue.h)("div",{ref:F,class:"vxe-body--x-space"}),(0,_vue.h)("table",{ref:E,class:"vxe-table--header",xid:x,cellspacing:0,cellpadding:0,border:0,xvm:p?"1":null},[(0,_vue.h)("colgroup",{ref:T},h.map((e,l)=>(0,_vue.h)("col",{name:e.id,key:l,style:{width:e.renderWidth+"px"}}))),(0,_vue.h)("thead",{ref:S},((a,t,i)=>{let n=g.fixedType,{headerRowClassName:d,headerRowStyle:o}=m;var e=b.value,l=i.map((e,l)=>{var r={$table:pe,$rowIndex:l,fixed:n,type:renderType};return(0,_vue.h)("tr",{key:l,class:["vxe-header--row",d?_xeUtils.default.isFunction(d)?d(r):d:""],style:o?_xeUtils.default.isFunction(o)?o(r):o:null},O(a,t,i,l,e))});return e.enabled&&l.push((0,_vue.h)("tr",{key:"ff",class:["vxe-header--row"]},I(t,i[i.length-1]))),l})(t,p,v))]),a&&c.area?(0,_vue.h)("div",{class:"vxe-table--cell-area",xid:x},[(0,_vue.h)("span",{class:"vxe-table--cell-main-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-clip-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-extend-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-multi-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-active-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-col-status-area"})]):renderEmptyElement(pe)])])}}});